# This config was automatically generated from your source code
# Stacks detected: deps:node:frontend,deps:python:backend,package_manager:poetry:backend
version: 2.1

orbs:
  aws-cli: circleci/aws-cli@5.2.0
  aws-ecr: circleci/aws-ecr@9.3.7
  aws-ecs: circleci/aws-ecs@6.0.2

jobs:
  build_and_push_images:
    docker:
      - image: cimg/base:2021.04
    steps:
      - checkout
      - setup_remote_docker
      - aws-ecr/build_and_push_image:
          auth:
            - aws-cli/setup
          repo: ai-money/frontend
          path: ./frontend
          tag: ${CIRCLE_SHA1}

  deploy-to-aws:
    docker:
      - image: cimg/python:3.10
    steps:
      - checkout
      - aws-ecs/update_task_definition_from_json:
          task_definition_json: frontend/task-definition.json
          

    

workflows:
  release-deploy:
    jobs:
      - build_and_push_images
          # filters:
          #   branches:
          #     ignore: /.*/
          #   tags:
          #     only: /^v.*/
      - deploy-to-aws:
          requires:
            - build_and_push_images
          # filters:
          #   branches:
          #     only: /^circleci-project-setup$/
            # tags:
            #   only: /^v.*/

# To create a release and trigger deployment:
# git tag v1.0.0
# git push origin v1.0.0
